{"version":3,"sources":["../../../src/features/presence/PresenceCollaboratorsList.js"],"names":["React","classnames","PropTypes","throttle","FormattedMessage","injectIntl","Button","PresenceCollaborator","messages","PresenceCollaboratorsList","isScrollableAbove","isScrollableBelow","elem","scrollTop","scrollHeight","clientHeight","event","onScroll","props","elDropdownList","setState","calculateOverflow","handleScroll","leading","trailing","recentActivity","getLinkCallback","inviteCallback","getLinkButtonText","inviteButtonText","overflow","state","collaborators","buttonsPresent","dropdownListClasses","title","renderTitle","actions","renderActions","list","throttledHandleScroll","map","collaborator","id","Component","arrayOf","shape","avatarUrl","string","oneOfType","number","isActive","bool","interactedAt","interactionType","name","isRequired","profileUrl","func","intl","any","PresenceCollaboratorsListComponent"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;AACA,OAAOC,UAAP,MAAuB,YAAvB;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,OAAOC,QAAP,MAAqB,iBAArB;AACA,SAASC,gBAAT,EAA2BC,UAA3B,QAA6C,YAA7C;AAEA,OAAOC,MAAP,MAAmB,yBAAnB;AACA,OAAOC,oBAAP,MAAiC,wBAAjC;AACA,OAAOC,QAAP,MAAqB,YAArB;AAEA,OAAO,kCAAP;;IAEMC,yB;;;;;;;;;;;;;;;;;;4DA6BM;AACJC,MAAAA,iBAAiB,EAAE,KADf;AAEJC,MAAAA,iBAAiB,EAAE;AAFf,K;;wEA0BY,UAAAC,IAAI,EAAI;AACxB,UAAMF,iBAAiB,GAAGE,IAAI,CAACC,SAAL,GAAiB,CAA3C;AACA,UAAMF,iBAAiB,GAAGC,IAAI,CAACC,SAAL,GAAiBD,IAAI,CAACE,YAAL,GAAoBF,IAAI,CAACG,YAApE;AACA,aAAO;AACHL,QAAAA,iBAAiB,EAAjBA,iBADG;AAEHC,QAAAA,iBAAiB,EAAjBA;AAFG,OAAP;AAIH,K;;mEAEc,UAAAK,KAAK,EAAI;AAAA,UACZC,QADY,GACC,MAAKC,KADN,CACZD,QADY;;AAEpB,UAAI,MAAKE,cAAT,EAAyB;AACrB,cAAKC,QAAL,CAAc,MAAKC,iBAAL,CAAuB,MAAKF,cAA5B,CAAd;;AACA,YAAIF,QAAJ,EAAc;AACVA,UAAAA,QAAQ,CAACD,KAAD,CAAR;AACH;AACJ;AACJ,K;;4EAEuBb,QAAQ,CAAC,MAAKmB,YAAN,EAAoB,EAApB,EAAwB;AACpDC,MAAAA,OAAO,EAAE,IAD2C;AAEpDC,MAAAA,QAAQ,EAAE;AAF0C,KAAxB,C;;kEAKlB;AAAA,aACV;AAAK,QAAA,SAAS,EAAC;AAAf,SACI,oBAAC,gBAAD,EAAsBhB,QAAQ,CAACiB,cAA/B,CADJ,CADU;AAAA,K;;oEAME,YAAM;AAAA,wBAC0B,MAAKP,KAD/B;AAAA,UACVQ,eADU,eACVA,eADU;AAAA,UACOC,cADP,eACOA,cADP;AAGlB,aACI,CAACD,eAAe,IAAIC,cAApB,KACI;AAAK,QAAA,SAAS,EAAC;AAAf,SACI,iCACKD,eAAe,IACZ,oBAAC,MAAD;AAAQ,QAAA,OAAO,EAAEA;AAAjB,SACI,oBAAC,gBAAD,EAAsBlB,QAAQ,CAACoB,iBAA/B,CADJ,CAFR,EAMKD,cAAc,IACX,oBAAC,MAAD;AAAQ,QAAA,OAAO,EAAEA;AAAjB,SACI,oBAAC,gBAAD,EAAsBnB,QAAQ,CAACqB,gBAA/B,CADJ,CAPR,CADJ,CAFR;AAkBH,K;;;;;;;wCAxEmB;AAChB,UAAMC,QAAQ,GAAG,KAAKT,iBAAL,CAAuB,KAAKF,cAA5B,CAAjB,CADgB,CAEhB;;AACA,WAAKC,QAAL,CAAcU,QAAd;AACH;;;yCAEoB;AACjB,UAAMA,QAAQ,GAAG,KAAKT,iBAAL,CAAuB,KAAKF,cAA5B,CAAjB;AACA;;;;;AAIA,UACIW,QAAQ,CAACpB,iBAAT,KAA+B,KAAKqB,KAAL,CAAWrB,iBAA1C,IACAoB,QAAQ,CAACnB,iBAAT,KAA+B,KAAKoB,KAAL,CAAWpB,iBAF9C,EAGE;AACE;AACA,aAAKS,QAAL,CAAcU,QAAd;AACH;AACJ;;;6BAuDQ;AAAA;;AAAA,wBAC4C,KAAKC,KADjD;AAAA,UACGrB,iBADH,eACGA,iBADH;AAAA,UACsBC,iBADtB,eACsBA,iBADtB;AAAA,yBAEsD,KAAKO,KAF3D;AAAA,UAEGc,aAFH,gBAEGA,aAFH;AAAA,UAEkBN,eAFlB,gBAEkBA,eAFlB;AAAA,UAEmCC,cAFnC,gBAEmCA,cAFnC;AAGL,UAAMM,cAAc,GAAGP,eAAe,IAAIC,cAA1C;AAEA,UAAMO,mBAAmB,GAAGjC,UAAU,CAAC,oCAAD,EAAuC;AACzE,2BAAmB,CAACgC,cADqD;AAEzE,wCAAgCA,cAFyC;AAGzE,+BAAuBvB,iBAHkD;AAIzE,+BAAuBC;AAJkD,OAAvC,CAAtC;AAOA,UAAMwB,KAAK,GAAG,KAAKC,WAAL,EAAd;AACA,UAAMC,OAAO,GAAG,KAAKC,aAAL,EAAhB;AAEA,aACI;AAAK,QAAA,SAAS,EAAC;AAAf,SACKH,KADL,EAEI;AACI,QAAA,GAAG,EAAE,aAAAI,IAAI,EAAI;AACT,UAAA,MAAI,CAACpB,cAAL,GAAsBoB,IAAtB;AACH,SAHL;AAII,QAAA,SAAS,EAAEL,mBAJf;AAKI,QAAA,QAAQ,EAAE,KAAKM,qBALnB;AAMI,QAAA,IAAI,EAAC;AANT,SAQKR,aAAa,CAACS,GAAd,CAAkB,UAAAC,YAAY;AAAA,eAC3B,oBAAC,oBAAD;AAAsB,UAAA,YAAY,EAAEA,YAApC;AAAkD,UAAA,GAAG,EAAEA,YAAY,CAACC,EAApE;AAAwE,UAAA,IAAI,EAAC;AAA7E,UAD2B;AAAA,OAA9B,CARL,CAFJ,EAcKN,OAdL,CADJ;AAkBH;;;;EA7ImCrC,KAAK,CAAC4C,S;;gBAAxCnC,yB,eACiB;AACfuB,EAAAA,aAAa,EAAE9B,SAAS,CAAC2C,OAAV,CACX3C,SAAS,CAAC4C,KAAV,CAAgB;AACZ;AACAC,IAAAA,SAAS,EAAE7C,SAAS,CAAC8C,MAFT;;AAGZ;AACAL,IAAAA,EAAE,EAAEzC,SAAS,CAAC+C,SAAV,CAAoB,CAAC/C,SAAS,CAAC8C,MAAX,EAAmB9C,SAAS,CAACgD,MAA7B,CAApB,CAJQ;AAKZC,IAAAA,QAAQ,EAAEjD,SAAS,CAACkD,IALR;;AAMZ;AACAC,IAAAA,YAAY,EAAEnD,SAAS,CAACgD,MAPZ;;AAQZ;AACAI,IAAAA,eAAe,EAAEpD,SAAS,CAAC8C,MATf;;AAUZ;AACAO,IAAAA,IAAI,EAAErD,SAAS,CAAC8C,MAAV,CAAiBQ,UAXX;;AAYZ;AACAC,IAAAA,UAAU,EAAEvD,SAAS,CAAC8C;AAbV,GAAhB,CADW,EAgBbQ,UAjBa;;AAkBf;AACA9B,EAAAA,eAAe,EAAExB,SAAS,CAACwD,IAnBZ;;AAoBf;AACA/B,EAAAA,cAAc,EAAEzB,SAAS,CAACwD,IArBX;;AAsBf;AACAzC,EAAAA,QAAQ,EAAEf,SAAS,CAACwD,IAvBL;;AAwBf;AACAC,EAAAA,IAAI,EAAEzD,SAAS,CAAC0D;AAzBD,C;;AA+IvB,SAASnD,yBAAyB,IAAIoD,kCAAtC;AACA,eAAexD,UAAU,CAACI,yBAAD,CAAzB","sourcesContent":["import * as React from 'react';\nimport classnames from 'classnames';\nimport PropTypes from 'prop-types';\nimport throttle from 'lodash/throttle';\nimport { FormattedMessage, injectIntl } from 'react-intl';\n\nimport Button from '../../components/button';\nimport PresenceCollaborator from './PresenceCollaborator';\nimport messages from './messages';\n\nimport './PresenceCollaboratorsList.scss';\n\nclass PresenceCollaboratorsList extends React.Component<Props> {\n    static propTypes = {\n        collaborators: PropTypes.arrayOf(\n            PropTypes.shape({\n                /** Url to avatar image. If passed in, component will render the avatar image instead of the initials */\n                avatarUrl: PropTypes.string,\n                /** Users id */\n                id: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n                isActive: PropTypes.bool,\n                /** Unix timestamp of when the user last interacted with the document */\n                interactedAt: PropTypes.number,\n                /** The type of interaction by the user */\n                interactionType: PropTypes.string,\n                /** User's full name */\n                name: PropTypes.string.isRequired,\n                /** Custom Profile URL */\n                profileUrl: PropTypes.string,\n            }),\n        ).isRequired,\n        /* Get Link button callback. also controls visibility of button */\n        getLinkCallback: PropTypes.func,\n        /* Show Invite button callback. also controls visibility of button */\n        inviteCallback: PropTypes.func,\n        /* Callback for Dropdown onScroll event */\n        onScroll: PropTypes.func,\n        /* Intl object */\n        intl: PropTypes.any,\n    };\n\n    state = {\n        isScrollableAbove: false,\n        isScrollableBelow: false,\n    };\n\n    componentDidMount() {\n        const overflow = this.calculateOverflow(this.elDropdownList);\n        // eslint-disable-next-line react/no-did-mount-set-state\n        this.setState(overflow);\n    }\n\n    componentDidUpdate() {\n        const overflow = this.calculateOverflow(this.elDropdownList);\n        /**\n         * recalculate overflow when dropdown is visible and new collabs are added\n         * This will not go into an infinite loop because we check for changes in local component state\n         */\n        if (\n            overflow.isScrollableAbove !== this.state.isScrollableAbove ||\n            overflow.isScrollableBelow !== this.state.isScrollableBelow\n        ) {\n            // eslint-disable-next-line react/no-did-update-set-state\n            this.setState(overflow);\n        }\n    }\n\n    calculateOverflow = elem => {\n        const isScrollableAbove = elem.scrollTop > 0;\n        const isScrollableBelow = elem.scrollTop < elem.scrollHeight - elem.clientHeight;\n        return {\n            isScrollableAbove,\n            isScrollableBelow,\n        };\n    };\n\n    handleScroll = event => {\n        const { onScroll } = this.props;\n        if (this.elDropdownList) {\n            this.setState(this.calculateOverflow(this.elDropdownList));\n            if (onScroll) {\n                onScroll(event);\n            }\n        }\n    };\n\n    throttledHandleScroll = throttle(this.handleScroll, 50, {\n        leading: true,\n        trailing: true,\n    });\n\n    renderTitle = () => (\n        <div className=\"bdl-PresenceCollaboratorsList-title\">\n            <FormattedMessage {...messages.recentActivity} />\n        </div>\n    );\n\n    renderActions = () => {\n        const { getLinkCallback, inviteCallback } = this.props;\n\n        return (\n            (getLinkCallback || inviteCallback) && (\n                <div className=\"bdl-PresenceCollaboratorsList-actions\">\n                    <div>\n                        {getLinkCallback && (\n                            <Button onClick={getLinkCallback}>\n                                <FormattedMessage {...messages.getLinkButtonText} />\n                            </Button>\n                        )}\n                        {inviteCallback && (\n                            <Button onClick={inviteCallback}>\n                                <FormattedMessage {...messages.inviteButtonText} />\n                            </Button>\n                        )}\n                    </div>\n                </div>\n            )\n        );\n    };\n\n    render() {\n        const { isScrollableAbove, isScrollableBelow } = this.state;\n        const { collaborators, getLinkCallback, inviteCallback } = this.props;\n        const buttonsPresent = getLinkCallback || inviteCallback;\n\n        const dropdownListClasses = classnames('bdl-PresenceCollaboratorsList-list', {\n            'dropshadow-list': !buttonsPresent,\n            'dropshadow-list-with-buttons': buttonsPresent,\n            'is-scrollable-above': isScrollableAbove,\n            'is-scrollable-below': isScrollableBelow,\n        });\n\n        const title = this.renderTitle();\n        const actions = this.renderActions();\n\n        return (\n            <div className=\"bdl-PresenceCollaboratorsList\">\n                {title}\n                <div\n                    ref={list => {\n                        this.elDropdownList = list;\n                    }}\n                    className={dropdownListClasses}\n                    onScroll={this.throttledHandleScroll}\n                    role=\"list\"\n                >\n                    {collaborators.map(collaborator => (\n                        <PresenceCollaborator collaborator={collaborator} key={collaborator.id} role=\"listitem\" />\n                    ))}\n                </div>\n                {actions}\n            </div>\n        );\n    }\n}\n\nexport { PresenceCollaboratorsList as PresenceCollaboratorsListComponent };\nexport default injectIntl(PresenceCollaboratorsList);\n"],"file":"PresenceCollaboratorsList.js"}