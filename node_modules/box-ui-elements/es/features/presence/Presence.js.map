{"version":3,"sources":["../../../src/features/presence/Presence.js"],"names":["React","Component","classNames","PropTypes","FormattedMessage","injectIntl","Button","messages","PresenceAvatarList","PresenceCollaboratorsList","ARROW_DOWN","ENTER","SPACE","collaboratorsPropType","flyoutPositionPropType","Flyout","Overlay","GROWTH_382_EXPERIMENT_BUCKET","GROWTH_382_AUTOFLY_CLASS","GROWTH_382_AUTOFLY_CLASS_FIRST_LOAD","Presence","isDropdownActive","showActivityPrompt","Boolean","props","collaborators","length","onClickViewCollaborators","experimentBucket","el","presenceContainerEl","event","onFlyoutOpen","setState","onFlyoutClose","stopPropagation","preventDefault","click","key","openDropDown","stopPropagationAndPreventDefault","avatarAttributes","className","closeOnWindowBlur","constrainToScrollParent","constrainToWindow","containerAttributes","flyoutPosition","getLinkCallback","intl","inviteCallback","maxAdditionalCollaboratorsNum","maxDisplayedAvatars","onAvatarMouseEnter","onAvatarMouseLeave","onFlyoutScroll","state","onAccessStatsRequested","requestAccessStats","previewPresenceFlyoutAccessStatsLink","overlayClassNames","overlayContent","previewPresenceFlyoutCopy","_showRecentsFlyout","previewPresenceFlyoutActivityCTA","_handleOverlayClose","_handleOverlayOpen","saveRefToContainer","formatMessage","toggleButtonLabel","handleKeyDown","object","string","arrayOf","isRequired","func","number","bool","any","PresenceComponent"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport classNames from 'classnames';\nimport PropTypes from 'prop-types';\nimport { FormattedMessage, injectIntl } from 'react-intl';\nimport Button from '../../components/button';\nimport messages from './messages';\nimport PresenceAvatarList from './PresenceAvatarList';\nimport PresenceCollaboratorsList from './PresenceCollaboratorsList';\nimport { ARROW_DOWN, ENTER, SPACE } from '../../common/keyboard-events';\nimport { collaboratorsPropType, flyoutPositionPropType } from './propTypes';\nimport { Flyout, Overlay } from '../../components/flyout';\nimport {\n    GROWTH_382_EXPERIMENT_BUCKET,\n    GROWTH_382_AUTOFLY_CLASS,\n    GROWTH_382_AUTOFLY_CLASS_FIRST_LOAD,\n} from './constants';\nimport './Presence.scss';\n\nclass Presence extends Component {\n    /* eslint-disable no-underscore-dangle */\n    static propTypes = {\n        /** Addtional attributes for avatar container */\n        avatarAttributes: PropTypes.object,\n        className: PropTypes.string,\n        collaborators: PropTypes.arrayOf(collaboratorsPropType).isRequired,\n        /** Addtional attributes for presence container */\n        containerAttributes: PropTypes.object,\n        /** Get Link callback */\n        getLinkCallback: PropTypes.func,\n        /** Invite button callback */\n        inviteCallback: PropTypes.func,\n        /** Maximum number of avatars to display before showing a +{n} avatar */\n        maxDisplayedAvatars: PropTypes.number,\n        /** Maximum number of collaborators before displaying a {maxAdditionalCollaboratorsNum}+ avatar */\n        maxAdditionalCollaboratorsNum: PropTypes.number,\n        /** Callback funtion for avatar mouseEnter, argument: id of user */\n        onAvatarMouseEnter: PropTypes.func,\n        /** Callback function for avatar mouseLeave */\n        onAvatarMouseLeave: PropTypes.func,\n        /** Callback funtion for Flyout events, argument: SyntheticEvent */\n        onFlyoutClose: PropTypes.func,\n        onFlyoutOpen: PropTypes.func,\n        onFlyoutScroll: PropTypes.func,\n        /** GROWTH-382 bucketing */\n        experimentBucket: PropTypes.string,\n        /** GROWTH-382 broadcast that the user wants to view stats from the flyout */\n        onAccessStatsRequested: PropTypes.func,\n        /** GROWTH-382 log that the user wants to view collaborators from the flyout */\n        onClickViewCollaborators: PropTypes.func,\n        /** Option to change the orientation of the dropdown. MUST be: bottom-right, bottom-left, bottom-center etc. or in this specific format */\n        flyoutPosition: flyoutPositionPropType,\n        /** Sets the tether constraint to scrollParent for the flyout */\n        constrainToScrollParent: PropTypes.bool,\n        /** Sets the tether constraint to window for the flyout */\n        constrainToWindow: PropTypes.bool,\n        /** Closes the flyout when window loses focus */\n        closeOnWindowBlur: PropTypes.bool,\n        intl: PropTypes.any,\n    };\n\n    static defaultProps = {\n        className: '',\n        maxDisplayedAvatars: 3,\n        maxAdditionalCollaboratorsNum: 99,\n        experimentBucket: null,\n        flyoutPosition: 'bottom-left',\n        constrainToScrollParent: true,\n        constrainToWindow: false,\n        closeOnWindowBlur: false,\n    };\n\n    state = {\n        isDropdownActive: false,\n        showActivityPrompt: Boolean(\n            this.props.collaborators.length &&\n                this.props.onClickViewCollaborators &&\n                this.props.experimentBucket === GROWTH_382_EXPERIMENT_BUCKET,\n        ),\n    };\n\n    saveRefToContainer = el => {\n        this.presenceContainerEl = el;\n    };\n\n    _handleOverlayOpen = event => {\n        const { onFlyoutOpen } = this.props;\n        this.setState({\n            isDropdownActive: true,\n        });\n        if (onFlyoutOpen) {\n            onFlyoutOpen(event);\n        }\n    };\n\n    _handleOverlayClose = event => {\n        const { onFlyoutClose } = this.props;\n        this.setState({\n            isDropdownActive: false,\n        });\n        if (onFlyoutClose) {\n            onFlyoutClose(event);\n        }\n    };\n\n    stopPropagationAndPreventDefault = event => {\n        event.stopPropagation();\n        event.preventDefault();\n    };\n\n    openDropDown = () => {\n        if (this.presenceContainerEl) {\n            this.presenceContainerEl.click();\n        }\n    };\n\n    handleKeyDown = event => {\n        switch (event.key) {\n            case ARROW_DOWN:\n            case ENTER:\n            case SPACE:\n                this.openDropDown();\n                this.stopPropagationAndPreventDefault(event);\n                break;\n\n            default:\n                break;\n        }\n    };\n\n    // GROWTH-382 click through the first CTA, spawn the normal Presence dropdown\n    _showRecentsFlyout = event => {\n        const { onClickViewCollaborators } = this.props;\n        onClickViewCollaborators();\n        this.stopPropagationAndPreventDefault(event);\n        this.setState({ showActivityPrompt: false });\n    };\n\n    render() {\n        const {\n            avatarAttributes,\n            className,\n            closeOnWindowBlur,\n            collaborators,\n            constrainToScrollParent,\n            constrainToWindow,\n            containerAttributes,\n            flyoutPosition,\n            getLinkCallback,\n            intl,\n            inviteCallback,\n            maxAdditionalCollaboratorsNum,\n            maxDisplayedAvatars,\n            onAvatarMouseEnter,\n            onAvatarMouseLeave,\n            onFlyoutScroll,\n        } = this.props;\n\n        const { isDropdownActive } = this.state;\n\n        // GROWTH-382\n        const { experimentBucket, onAccessStatsRequested } = this.props;\n        const { showActivityPrompt } = this.state;\n        let requestAccessStats = null;\n\n        if (!showActivityPrompt && experimentBucket === GROWTH_382_EXPERIMENT_BUCKET) {\n            requestAccessStats = (\n                // eslint-disable-next-line jsx-a11y/anchor-is-valid\n                <a className=\"presence-overlay-request-stats\" href=\"#\" onClick={onAccessStatsRequested}>\n                    <FormattedMessage {...messages.previewPresenceFlyoutAccessStatsLink} />\n                </a>\n            );\n        }\n\n        const overlayClassNames = classNames('presence-overlay', {\n            [GROWTH_382_AUTOFLY_CLASS]: experimentBucket && !showActivityPrompt,\n            [GROWTH_382_AUTOFLY_CLASS_FIRST_LOAD]: experimentBucket && showActivityPrompt,\n        });\n\n        const overlayContent = showActivityPrompt ? (\n            <>\n                <FormattedMessage {...messages.previewPresenceFlyoutCopy} />\n                <Button className=\"btn-primary\" onClick={this._showRecentsFlyout}>\n                    <FormattedMessage {...messages.previewPresenceFlyoutActivityCTA} />\n                </Button>\n            </>\n        ) : (\n            <PresenceCollaboratorsList\n                collaborators={collaborators}\n                experimentBucket={experimentBucket}\n                getLinkCallback={getLinkCallback}\n                inviteCallback={inviteCallback}\n                onScroll={onFlyoutScroll}\n            />\n        );\n        return (\n            <Flyout\n                className={`presence ${className}`}\n                closeOnWindowBlur={closeOnWindowBlur}\n                constrainToScrollParent={constrainToScrollParent}\n                constrainToWindow={constrainToWindow}\n                isVisibleByDefault={showActivityPrompt}\n                onClose={this._handleOverlayClose}\n                onOpen={this._handleOverlayOpen}\n                position={flyoutPosition}\n            >\n                <PresenceAvatarList\n                    ref={this.saveRefToContainer}\n                    aria-label={intl.formatMessage(messages.toggleButtonLabel)}\n                    avatarAttributes={avatarAttributes}\n                    className={classNames('presence-avatar-container', { 'dropdown-active': isDropdownActive })}\n                    collaborators={collaborators}\n                    hideTooltips={isDropdownActive}\n                    maxAdditionalCollaborators={maxAdditionalCollaboratorsNum}\n                    maxDisplayedAvatars={maxDisplayedAvatars}\n                    onAvatarMouseEnter={onAvatarMouseEnter}\n                    onAvatarMouseLeave={onAvatarMouseLeave}\n                    onKeyDown={this.handleKeyDown}\n                    {...containerAttributes}\n                />\n                <Overlay className={overlayClassNames} shouldDefaultFocus={false}>\n                    {overlayContent}\n                    {requestAccessStats}\n                </Overlay>\n            </Flyout>\n        );\n    }\n}\n\nexport { Presence as PresenceComponent };\nexport default injectIntl(Presence);\n"],"file":"Presence.js"}