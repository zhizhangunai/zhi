# i18n

Box has a very specific i18n workflow. All `react-intl` messages in applications are compiled into a single `i18n/en-US.properties` file that gets sent to our Moji translation service. This service will then commit `i18n/{language}.properties` files back into your repo.

For our React applications, we need to convert these translations back into `react-intl` messages, which involves a set of tools found in this repository:

<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->

- [Babel Configuration](#babel-configuration)
- [i18n Folder Structure](#i18n-folder-structure)
- [Languages](#languages)
  - [Example Usage:](#example-usage)
- [buildTranslations.js](#buildtranslationsjs)
  - [Example Usage:](#example-usage-1)
- [props2es.js](#props2esjs)
  - [Example Usage (package.json)](#example-usage-packagejson)
- [buildLanguageBundles.js](#buildlanguagebundlesjs)
  - [Arguments](#arguments)
  - [Example Usage:](#example-usage-2)
  - [Example Output Bundle file:](#example-output-bundle-file)
- [TranslationsPlugin](#translationsplugin)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

## Babel Configuration

We rely on the official `babel-plugin-react-intl` to pull translations in your application into a central place.

Your `babel.config.js` should contain the following configuration:

```
  plugins: [
    [
      "react-intl",
      {
        messagesDir: "./i18n/json",
        enforceDescriptions: true,
      },
    ],
  ],
```

## i18n Folder Structure

This is the standard Box `i18n` structure that your application or library should have

```
projectRoot
  |-- i18n/
    |-- json/
      |-- ...react-intl files
    |-- bundles/                       // applications only
      |-- en-US.js                      // generated
      |-- ...other language bundles
    |-- en-US.properties               // Primary translation .properties file - check this in!
    |-- en-US.js                       // generated
    |-- ...other language files
  |-- src/
...
```

## Languages

The list can be found at https://github.com/box/box-languages.
It is the full list of BCP-47 language tags that are officially supported by Box.

### Example Usage:

```js
const languages = require('@box/languages');
languages.forEach(...do something...);
```

## buildTranslations.js

**_You should not be using this script directly. It should be used via the webpack `TranslationsPlugin.js` and `props2es.js` script file as mentioned below._**

Babel plugin for react-intl outputs all messages in JSON format inside `i18n/json`. These JSON files are also not aggregated, and hence there is a JSON file per JS file that has messages. Moji wants an aggregated properties file per language while our own code wants an aggregated ES module file per langauge. Hence this script does two things:

1. Reads non-aggregated JSON output from `i18n/json/**/*.json` and writes the `i18n/en-US.properties` file with all the english messages. The `i18n/en-US.properties` file is commited to git. When Moji runs on your git repo, it uses this `i18n/en-US.properties` and generates properties file per language within the same `i18n` folder. The number of properties files inside `i18n` should correspond to the number of languages from `@box/languages` above.
2. Reads all language specific properties files and writes corresponding ES files for each language. The output for this also goes into the `i18n` folder. These ES files are only published to NPM but not commited to git. Hence they are generated with every build and release. We distribute them as part of NPM for other projects to import in if needed.

### Example Usage:

```js
const buildTranslations = require('@box/frontend/i18n/buildTranslations');
buildTranslations();
```

## props2es.js

This is a stand alone node script for generating language specific ES and properties files from the output of react-intl's babel plugin. This script wraps and defers to the above mentioned `buildTranslations.js` script to do the actual transpiling. Use this script within your project as needed. Normally you would want to run this script once before webpack starts its own build so that there is an initial set of ES files for webpack to import from. You can make this part of your package.json's pre build step. This will compile all `i18n/*.properties` files into `i18n/*.js` files.

### Example Usage (package.json)

```js
...
  scripts: {
    ...,
    "build:i18n": "props2es"
    ...
  }
...
```

## buildLanguageBundles.js

**_You should not be using this script directly. It should be used via the webpack `TranslationsPlugin.js` mentioned below._**

This script generates a file per language that ties together message data from your app and other library translations. It makes it trivial to create code-split points based on user's language.

### Arguments

- `additionalMessageData: Array<string>` - Additional message data path to bundle in (You can use `[language]` or `[locale]` placeholders)

### Example Usage:

```js
const buildLanguageBundles = require('@box/frontend/i18n/buildLanguageBundles');
buildLanguageBundles([
  'box-react-ui/i18n/[language]',
  'box-ui-elements/i18n/[language]',
]);
```

### Example Output Bundle file:

```js
/**
 * Auto-generated Language Bundle File for fi-FI
 * @IMPORTANT: DO NOT MODIFY THIS FILE DIRECTLY
 */

import reactIntlLocaleData from 'react-intl/locale-data/fi';
import messageData0 from 'box-react-ui/i18n/fi-FI';
import messageData1 from 'box-ui-elements/i18n/fi-FI';
import appMessageData from '../fi-FI';

const language = 'fi-FI';
const locale = 'fi';

const messages = {
  ...messageData0,
  ...messageData1,
  ...appMessageData,
};

export { language, locale, messages, reactIntlLocaleData };
```

## TranslationsPlugin

This webpack plugin handles all of the i18n tasks including language bundle generation. See [TranslationsPlugin Documentation](../webpack/README.md#translationsplugin)
